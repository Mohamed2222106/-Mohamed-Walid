<!DOCTYPE html><html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بابا عبده</title>
    <style>
        body {font-family: Arial, sans-serif; direction: rtl; margin:0; padding:0; background:#f8f8f8;}
        header {background:#ff6600; color:white; padding:15px; position:relative; text-align:center;}
        .small-text {position:absolute; top:5px; left:10px; font-size:12px; color:white;}
        main {padding:20px;}
        .btn {padding:8px 16px; margin:5px; border:none; border-radius:5px; cursor:pointer; font-size:14px;}
        .btn-primary {background:#28a745; color:white;}
        .btn-secondary {background:#6c757d; color:white;}
        .btn-danger {background:#dc3545; color:white;}
        .btn:hover {opacity:0.9;}
        #tablesContainer {display:flex; flex-wrap:wrap; justify-content:center; margin-top:20px;}
        .table {width:100px; height:100px; background:white; border:2px solid #ff6600; margin:10px; display:flex; align-items:center; justify-content:center; cursor:pointer; border-radius:8px; transition:transform .2s; font-weight:bold;}
        .table:hover {transform:scale(1.05);}
        .modal-overlay {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center;}
        .modal {background:white; padding:20px; border-radius:8px; width:90%; max-width:400px; text-align:right;}
        .modal input, .modal textarea {width:100%; padding:8px; margin:5px 0; box-sizing:border-box; border:1px solid #ccc; border-radius:4px;}
        /* Dropdown and items grid */
        .dropdown-container {margin-top:20px;}
        #categoryDropdown {width:100%; padding:8px; font-size:14px; border-radius:5px; border:1px solid #ccc;}
        .items-grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:10px; margin-top:10px;}
        .card {background:white; padding:10px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); display:flex; flex-direction:column; justify-content:space-between;}
        .card h4 {margin:0 0 5px;}
        .card .price {font-size:14px; color:#555;}
        .card button {margin-top:10px; background:#28a745; color:white; border:none; border-radius:5px; padding:6px 0; cursor:pointer;}
        .card button:hover {opacity:0.9;}
        /* Orders list */
        .orders-list {list-style:none; padding:0; margin-top:20px;}
        .orders-list li {background:white; padding:10px; margin:5px 0; border-radius:5px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;}
        .note {width:100%; font-size:12px; color:#555; text-align:right; margin-top:5px;}
    </style>
</head>
<body>
<header>
    <h1>بابا عبده</h1>
    <span class="small-text">محمد وليد سعيد حسن عبد الهادي</span>
</header>
<main id="main-content">
    <button class="btn btn-primary" onclick="createTables()">إنشاء ترابيزات</button>
    <button class="btn btn-secondary" onclick="manageMenu()">إدارة المنيو</button>
    <div id="tablesContainer"></div>
</main><!-- Modals --><div class="modal-overlay" id="menuModal">
    <div class="modal">
        <h3 id="modalTitle">إضافة صنف</h3>
        <input type="text" id="menuName" placeholder="اسم الصنف">
        <input type="number" id="menuPrice" placeholder="السعر (جنيه)">
        <div style="text-align:left; margin-top:10px;">
            <button class="btn btn-primary" onclick="saveMenuItem()">حفظ</button>
            <button class="btn btn-secondary" onclick="closeMenuModal()">إلغاء</button>
        </div>
    </div>
</div>
<div class="modal-overlay" id="noteModal">
    <div class="modal">
        <h3>إضافة ملاحظة</h3>
        <textarea id="noteInput" rows="3" placeholder="اكتب الملاحظة..."></textarea>
        <div style="text-align:left; margin-top:10px;">
            <button class="btn btn-primary" onclick="saveNote()">إضافة</button>
            <button class="btn btn-secondary" onclick="closeNoteModal()">إلغاء</button>
        </div>
    </div>
</div><script>
// Global state
let editIndex = -1;
let currentNoteItem = null;

// -- Home/Manage Tables --
function createTables() {
    let num = prompt('كم عدد الترابيزات؟');
    if (!num || isNaN(num) || num<=0) return;
    localStorage.setItem('numTables', num);
    loadTables();
}
function loadTables() {
    let num = +localStorage.getItem('numTables')||0;
    let container = document.getElementById('tablesContainer');
    container.innerHTML = '';
    for(let i=1;i<=num;i++){
        let div=document.createElement('div');
        div.className='table';
        div.textContent=`طاولة ${i}`;
        div.onclick=()=>openTable(i);
        container.appendChild(div);
    }
}

// -- Menu Management --
function manageMenu(){
    let main=document.getElementById('main-content');
    main.innerHTML=`<h2>إدارة المنيو</h2>
        <div><input type="text" id="searchMenu" placeholder="🔍 بحث..." oninput="filterMenu()" style="width:60%;padding:8px;">
        <button class="btn btn-primary" onclick="openAddModal()">إضافة صنف +</button></div>
        <div id="menuList"></div>
        <div style="text-align:right;margin-top:10px;">عدد الأصناف: <span id="countMenu">0</span></div>
        <button class="btn btn-secondary" onclick="loadHome()">رجوع</button>`;
    displayMenuItems();
}
function displayMenuItems(){
    let list=document.getElementById('menuList');
    let menu=JSON.parse(localStorage.getItem('menu'))||[];
    list.innerHTML='';
    menu.forEach((item,idx)=>{
        let card=document.createElement('div');card.className='menu-card';
        card.innerHTML=`<h4>${item.name}</h4><div>${item.price} جنيه</div>
            <div class="menu-actions">
            <button class="btn btn-secondary" onclick="openEditModal(${idx})">✏️</button>
            <button class="btn btn-danger" onclick="removeMenuItem(${idx})">🗑️</button>
            </div>`;
        list.appendChild(card);
    });
    document.getElementById('countMenu').textContent=menu.length;
}
function filterMenu(){
    let q=document.getElementById('searchMenu').value.trim().toLowerCase();
    document.querySelectorAll('.menu-card').forEach(card=>{
        let name=card.querySelector('h4').textContent.toLowerCase();
        card.style.display=name.includes(q)?'flex':'none';
    });
}
function openAddModal(){editIndex=-1;document.getElementById('modalTitle').textContent='إضافة صنف';document.getElementById('menuName').value='';document.getElementById('menuPrice').value='';document.getElementById('menuModal').style.display='flex';}
function openEditModal(i){
    let menu=JSON.parse(localStorage.getItem('menu'))||[];
    editIndex=i;document.getElementById('modalTitle').textContent='تعديل صنف';document.getElementById('menuName').value=menu[i].name;document.getElementById('menuPrice').value=menu[i].price;document.getElementById('menuModal').style.display='flex';
}
function closeMenuModal(){document.getElementById('menuModal').style.display='none';}
function saveMenuItem(){
    let name=document.getElementById('menuName').value.trim();
    let price=document.getElementById('menuPrice').value.trim();
    if(!name||!price||isNaN(price))return;
    let menu=JSON.parse(localStorage.getItem('menu'))||[];
    if(editIndex>=0) menu[editIndex]={name,price:parseFloat(price)};
    else menu.push({name,price:parseFloat(price)});
    localStorage.setItem('menu',JSON.stringify(menu));closeMenuModal();displayMenuItems();
}
function removeMenuItem(i){if(!confirm('هل أنت متأكد؟'))return;let menu=JSON.parse(localStorage.getItem('menu'))||[];menu.splice(i,1);localStorage.setItem('menu',JSON.stringify(menu));displayMenuItems();}
function loadHome(){document.getElementById('main-content').innerHTML=`<button class="btn btn-primary" onclick="createTables()">إنشاء ترابيزات</button><button class="btn btn-secondary" onclick="manageMenu()">إدارة المنيو</button><div id="tablesContainer"></div>`;loadTables();}

// -- Orders with Dropdown --
function openTable(num){
    localStorage.setItem('currentTable',num);
    let main=document.getElementById('main-content');
    main.innerHTML=`<h2>إدارة الطلبات – طاولة ${num}</h2>
        <div class="dropdown-container">
            <select id="categoryDropdown"></select>
        </div>
        <div class="items-grid" id="menuGrid"></div>
        <h3>الطلبات</h3>
        <ul class="orders-list" id="ordersList"></ul>
        <div style="text-align:right;font-weight:bold; margin-top:10px;">الإجمالي: <span id="totalPrice">0</span> جنيه</div>
        <button class="btn btn-danger" onclick="clearOrders()">حذف الكل</button>
        <button class="btn btn-secondary" onclick="loadHome()">رجوع</button>`;
    initDropdown();
    displayOrders();
}

function initDropdown() {
    const dropdown = document.getElementById('categoryDropdown');
    const menu = JSON.parse(localStorage.getItem('menu')) || [];
    dropdown.innerHTML = '';
    menu.forEach((cat, idx) => {
        let opt = document.createElement('option');
        opt.value = idx;
        opt.textContent = cat.name;
        dropdown.appendChild(opt);
    });
    dropdown.onchange = renderItems;
    if (menu.length) renderItems();
}

function renderItems() {
    const idx = +document.getElementById('categoryDropdown').value;
    const items = (JSON.parse(localStorage.getItem('menu')) || [])[idx]?.items || [];
    const grid = document.getElementById('menuGrid'); grid.innerHTML = '';    
    items.forEach((item, i) => {
        let card = document.createElement('div'); card.className = 'card';
        card.innerHTML = `<h4>${item.name}</h4><div class="price">${item.price} ج</div>`;
        let btn = document.createElement('button'); btn.textContent = '+';
        btn.onclick = () => { currentNoteItem = item; openNoteModal(); };
        card.appendChild(btn);
        grid.appendChild(card);
    });
}

function openNoteModal() { document.getElementById('noteInput').value = ''; document.getElementById('noteModal').style.display = 'flex'; }
function closeNoteModal() { document.getElementById('noteModal').style.display = 'none'; }

function saveNote(){
    let note = document.getElementById('noteInput').value.trim();
    let table = localStorage.getItem('currentTable'); let key = `orders_${table}`;
    let orders = JSON.parse(localStorage.getItem(key)) || [];
    let item = currentNoteItem;
    let exist = orders.find(o => o.name===item.name && o.note===note);
    if (exist) exist.qty++;
    else orders.push({name:item.name, price:item.price, qty:1, note});
    localStorage.setItem(key, JSON.stringify(orders));
    closeNoteModal(); displayOrders();
}

function displayOrders(){
    let table = localStorage.getItem('currentTable'); let key = `orders_${table}`;
    let orders = JSON.parse(localStorage.getItem(key)) || [];
    let list = document.getElementById('ordersList'); list.innerHTML = '';
    let total = 0;
    orders.forEach((o, i) => {
        total += o.price * o.qty;
        let li = document.createElement('li');
        li.innerHTML = `<span>${o.name} × ${o.qty}</span><span>${o.price*o.qty} ج</span><div class="note">${o.note||''}</div><button class="btn btn-danger" onclick="removeOne(${i})">–</button>`;
        list.appendChild(li);
    });
    document.getElementById('totalPrice').textContent = total;
}

function removeOne(i){
    let table = localStorage.getItem('currentTable'); let key = `orders_${table}`;
    let orders = JSON.parse(localStorage.getItem(key)) || [];
    if (orders[i].qty>1) orders[i].qty--; else orders.splice(i,1);
    localStorage.setItem(key, JSON.stringify(orders));
    displayOrders();
}

function clearOrders(){
    if (confirm('هل أنت متأكد من حذف جميع الطلبات؟')){
        let table = localStorage.getItem('currentTable');
        localStorage.removeItem(`orders_${table}`);
        displayOrders();
    }
}

// Initialize
loadTables();
</script></body>
</html>
